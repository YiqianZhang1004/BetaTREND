% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gradient_projection.R
\name{gradient_projection}
\alias{gradient_projection}
\title{Trait-aligned projection in PCoA space (multiple algorithms)}
\usage{
gradient_projection(
  distance_matrix,
  trait,
  ndim = 5,
  figure = TRUE,
  projection = c("orthogonal", "none", "ordered"),
  lambda = 0
)
}
\arguments{
\item{distance_matrix}{A symmetric distance matrix (class \code{dist} or
numeric square matrix) of beta diversities.}

\item{trait}{Numeric vector of length \eqn{n} with the continuous
phenotype.}

\item{ndim}{Number of PCoA axes retained (default \code{5}).}

\item{figure}{Logical; if \code{TRUE} (default) draw a PCoA1–PCoA2
scatter coloured by the chosen projection or by the trait.}

\item{projection}{Character string: \code{"none"}, \code{"orthogonal"}
or \code{"ordered"} (see details above).}

\item{lambda}{Optional non-negative LASSO weight used \emph{only}
when \code{projection = "ordered"}; default \code{0}.}
}
\value{
A list with the same structure as the original implementation:
  \describe{
    \item{\code{projection_scores}}{Length-\eqn{n} vector used for colouring
          the plot (raw trait if \code{projection = "none"}).}
    \item{\code{gradient_direction}}{\eqn{\hat\beta}; \code{NA} when
          \code{projection = "none"}.}
    \item{\code{PCoA_coordinates}}{\eqn{n \times ndim} matrix of PCoA axes.}
    \item{\code{adjusted_R2}, \code{p_value}}{Model diagnostics returned only
          for the orthogonal fit; otherwise \code{NA}.}
    \item{\code{plot}}{A \pkg{ggplot2} object (or \code{NULL} if
          \code{figure = FALSE}).}
    \item{\code{variance_explained}}{Vector of eigenvalue proportions.}
  }
}
\description{
For a given \eqn{n \times n} beta-diversity matrix \eqn{D} and a continuous
trait vector \eqn{y}, compute a **one-dimensional score**
\eqn{\hat y = E\hat\beta} from the first \code{ndim} PCoA axes \eqn{E}.
 
The score is used *only* for colouring the PCoA plot; the user can choose
one of three projection rules:
}
\details{
\itemize{
  \item \strong{none}   — skip projection entirely and colour points by the
        raw trait.
  \item \strong{orthogonal}   — ordinary least-squares direction
        \eqn{\hat\beta = (E^\top E)^{-1}E^\top y}; returns adj.\;R\eqn{^2}
        and global F-test \eqn{p}.
  \item \strong{ordered}   — solve
        \deqn{\min_\beta \|y - E\beta\|_2^2 \quad
              \text{s.t. } (E_i-E_j)\beta > 0 \text{ if } y_i>y_j,\;
              (E_i-E_j)\beta = 0 \text{ if } y_i=y_j,}
        using \pkg{CVXR}.  
        Constraints are applied only to \emph{consecutive} trait-ordered
        samples for efficiency.  A non-negative \eqn{\ell_1} penalty
        (\code{lambda}) can be added to stabilise the solution when
        \eqn{ndim \gg n}.
}
}
