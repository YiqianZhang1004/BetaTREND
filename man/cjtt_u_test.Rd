% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cjtt_u_test.R
\name{cjtt_u_test}
\alias{cjtt_u_test}
\title{CJTT-U Trend Test for Beta-Dispersion vs. Continuous Trait}
\usage{
cjtt_u_test(
  dist_matrix,
  trait,
  confounder = NULL,
  var_method = c("analytic", "jackknife", "bootstrap"),
  permutation = FALSE,
  B = 1000,
  seed = 123
)
}
\arguments{
\item{dist_matrix}{Either a numeric \code{dist} object or an
\eqn{n\times n} distance matrix.}

\item{trait}{Numeric vector of length \eqn{n}.}

\item{confounder}{Optional \eqn{n\times p} matrix of confounders
(default \code{NULL}).}

\item{var_method}{Character.  Variance estimator:
\code{"analytic"} (default), \code{"jackknife"}, or \code{"bootstrap"}.}

\item{permutation}{Logical.  If \code{TRUE}, a permutation p-value is
returned instead of a z-test.}

\item{B}{Integer.  Number of bootstrap or permutation replicates
(default \code{1000}).}

\item{seed}{Integer for reproducibility.}
}
\value{
A list with elements:
\describe{
  \item{\code{U_statistic}}{Value of U in \([-1,1]\).}
  \item{\code{variance}}{Estimated variance (NA if permutation).}
  \item{\code{z_score}}{Standardised statistic (NA if permutation).}
  \item{\code{p_value}}{Two-sided p-value.}
  \item{\code{method}}{Variance method actually used.}
}
}
\description{
Implements the continuous-trait version of the U-statistic trend test
proposed on slides 9–12 (“CJTT-U”).  It tests whether sample-level beta
dispersion
\eqn{d_i = \frac{1}{n-1}\sum_{j\neq i} D_{ij}}
shows a monotone trend with a numeric trait
by computing
\deqn{U = \frac{1}{\binom{n}{2}} \sum_{i<j}
       \operatorname{sign}(y_j - y_i)\,
       \operatorname{sign}(d_j - d_i).}
}
\details{
Variance can be estimated analytically, via leave-one-out jackknife, or by
non-parametric bootstrap.  A permutation option is also provided.

If a matrix of confounders is supplied, double residualisation à la
Frisch–Waugh–Lovell (FWL) is applied to both the trait and the distance
matrix using \eqn{P = I - Z\,(Z^\top Z)^{-1}Z^\top}.  
**Note:** residualising a distance matrix directly is an approximation;
for exact FWL you should residualise ordination **coordinates** first and
then recompute distances.
}
\examples{
\dontrun{
  library(vegan)
  set.seed(1)
  otu   <- matrix(abs(rnorm(40 * 25)), nrow = 40)
  trait <- seq(1, 40) + rnorm(40, 0, 2)
  D     <- vegdist(otu, "bray")

  # analytic variance
  cjtt_u_test(D, trait)

  # jackknife with a confounder (e.g., age)
  age <- rnorm(40, 50, 8)
  cjtt_u_test(D, trait, confounder = age, var_method = "jackknife")
}

}
